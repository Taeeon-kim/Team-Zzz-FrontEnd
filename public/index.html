<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="Web site created using create-react-app" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <script type="text/javascript" src="https://developers.kakao.com/sdk/js/kakao.js"></script>
  <script>
    Kakao.init("c51fcbffb9ee44d3b90e755eff2bf5b6");
  </script>
  <!-- manifest -->
  <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
  <link rel="apple-touch-icon" sizes="192x192" href="logo192.png" />
  <link rel="apple-touch-icon" sizes="512x512" href="logo512.png" />
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-05KE6WCMTW"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "G-05KE6WCMTW");
  </script>

  <title>Zzz</title>
</head>

  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <!-- <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- <a href="intent://scan/#Intent;scheme=zxing;package=com.android.chrome;S.browser_fallback_url=http%3A%2F%2Fzxing.org;end"> Take a QR code </a> -->
    <!-- <script>window.open("intent://www.naver.com#Intent;scheme=http;package=com.android.chrome;end");</script> -->
    <!-- <script> location.href='intent://www.zzzapp.co.kr#Intent;scheme=http;package=com.android.chrome;end' </script> -->
<!-- <script>
  // var win = window.open("http://www.zzzapp.co.kr/", "PopupWin", "width=100vw,height=100vh");

// win.document.write("<p>새창에 표시될 내용 입니다.</p>");
</script> -->



    <!-- <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-analytics.js">
    </script>
    =======
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-analytics.js"></script>

    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
<script>
  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  var firebaseConfig = {
    apiKey: "AIzaSyBHpknHwT99Y6l4OPhZhShtMql4OVzL968",
        authDomain: "push-e53ad.firebaseapp.com",
        projectId: "push-e53ad",
        storageBucket: "push-e53ad.appspot.com",
        messagingSenderId: "496302701496",
        appId: "1:496302701496:web:5c79f13992451572c4ad4d",
        measurementId: "G-PCQK3HYY0G",
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  // firebase.analytics();
</script> -->

  <!-- <script>
      let swRegist = null;
      let isSubscribed = true;
      Notification.requestPermission().then(function (permission) {
        // if ("serviceWorker" in navigator) {
        if (Notification.permission === "granted") {
          navigator.serviceWorker
            .register("./sw.js") // 서비스워커 등록 public에 있는 sw.js 의 경로로 등록해줌
            .then((regist) => {
              swRegist = regist;
              test(swRegist);
              console.log("권한 승인해서 서비스워커 등록!");
              console.log(swRegist);
            }); // 권한 허용이 되었다면 실행
        }
        if (Notification.permission === "denied") {
          // 권한 차단 했을경우 실행
          console.log("권한 거부했음!");
          updateSubscription(null);
          return;
        }
        // }
      });
      const test = (swRegist) => {
        console.log(swRegist);
        swRegist = swRegist;
        const initPush = (isSubscribed) => {
          console.log(swRegist);
          // const pushButton = document.getElementById("subscribe");
          // pushButton.addEventListener("click", () => {
          // console.log(isSubscribed);
          // if (isSubscribed) {
          //   unsubscribe();
          // } else {
          subscribe();
          // }
          // }
          // );
          console.log(swRegist);
          swRegist.pushManager.getSubscription().then(function (subscription) {
            isSubscribed = !(subscription === null); // null 이면 true 이니 !true 가 false 로 해서 isSubscribed 가 false 라는뜻
            updateSubscription(subscription); // updateSubscription 함수로 구독 정보를 전달
            if (isSubscribed) {
              console.log("User IS subscribed.");
            } else {
              console.log("User is NOT subscribed.");
            }
            updateButton();
          });

          function subscribe() {
            let appServerPublicKey =
              "BCx9jhZ9DcQIfH1TxwGxM_20aQMEdV_SbEsrBT-KCKOFUPlbAQ4nrgbnH3nBsaR8tGib2kHtxTKUE1SGdSatZ7w"; // 자신의 public key 넣어줘야함
            const applicationServerKey =
              urlBase64ToUint8Array(appServerPublicKey);
            swRegist.pushManager
              .subscribe({
                userVisibleOnly: true,
                applicationServerKey: applicationServerKey,
              })
              .then((subscription) => {
                console.log("User is subscribed.");
                updateSubscription(subscription);
                console.log(subscription);
                isSubscribed = true; // 구독정보를 반아온 경우 구독을 정상적으로 한 상황이므로 true로 변경
                updateButton();
              })
              .catch((err) => {
                console.log("Failed to subscribe the user: ", err);
                updateButton();
              });
          }
          //구독 버튼 상태 갱신
          function updateButton() {
            // TODO: 알림 권한 거부 처리
            if (Notification.permission === "granted") {
              // 권한 허용이 되었다면 실행
              // new Notification("푸시허용 테스트 알림!!"); // 알림 내용 그대로 보여줌
            }
            if (Notification.permission === "denied") {
              // 권한 차단 했을경우 실행
              updateSubscription(null);
              return;
            }
            // const pushButton = document.getElementById("subscribe");
            if (isSubscribed) {
              // pushButton.textContent = "Disable Push Messaging";
            } else {
              // pushButton.textContent = "Enable Push Messaging";
            }
            // pushButton.disabled = false; // true로하면 해당 버튼이 안눌리고 비활성화 된다.
          }
          // 구독 정보 갱신
          function updateSubscription(subscription) {
            // TODO: 구독 정보 서버로 전송
            // let detailArea = document.getElementById("subscription_detail");
            if (subscription) {
              console.log(JSON.stringify(subscription));
              //             return fetch(`https://www.zzzback.shop/api/subscription`, {
              //   method: 'POST',
              //   body: JSON.stringify({
              //     subscription:subscription,
              //     title:"Notified by Precision Ordance",
              //     description:"someone buy a product",
              //     icon:"https://ichef.bbci.co.uk/news/976/cpsprodpb/9A50/production/_118740593_gettyimages-1231144196.jpg"
              //   }),
              //   headers: {
              //     'Content-Type': 'application/json'
              //   }
              // })

              axios
                .post(
                  "https://www.zzzback.shop/api/notifications/subscribe",
                  {
                    body: JSON.stringify({
                      subscription: subscription,
                      title: "Notified by Precision Ordance",
                      description: "someone buy a product",
                      icon: "https://ichef.bbci.co.uk/news/976/cpsprodpb/9A50/production/_118740593_gettyimages-1231144196.jpg",
                    }),
                  },
                  {
                    headers: {
                      "Content-Type": "application/json",
                    },
                  }
                )
                .then((res) => {
                  console.log(res);
                  console.log("Dd");
                });

              // detailArea.innerText = JSON.stringify(subscription);
              // detailArea.parentElement.classList.remove("hide");
            } else {
              // detailArea.parentElement.classList.add("hide");
            }
          }
          //알림 구독 취소
          function unsubscribe() {
            swRegist.pushManager
              .getSubscription()
              .then((subscription) => {
                if (subscription) {
                  return subscription.unsubscribe();
                }
              })
              .catch((error) => {
                console.log("Error unsubscribing", error);
              })
              .then(() => {
                updateSubscription(null);
                console.log("User is unsubscribed.");
                isSubscribed = false;
                updateButton();
              });
          }

          function urlBase64ToUint8Array(base64String) {
            var padding = "=".repeat((4 - (base64String.length % 4)) % 4);
            var base64 = (base64String + padding)
              .replace(/\-/g, "+")
              .replace(/_/g, "/");
            var rawData = window.atob(base64);
            var outputArray = new Uint8Array(rawData.length);
            for (var i = 0; i < rawData.length; ++i) {
              outputArray[i] = rawData.charCodeAt(i);
            }
            return outputArray;
          }
        };
        initPush();
      };

            function sendSubscription(subscription) {
        return fetch(`/notifications/subscribe`, {
          method: 'POST',
          body: JSON.stringify({
            subscription:subscription,
            title:"Notified by Precision Ordance",
            description:"someone buy a product",
            icon:"https://ichef.bbci.co.uk/news/976/cpsprodpb/9A50/production/_118740593_gettyimages-1231144196.jpg"
          }),
          headers: {
            'Content-Type': 'application/json'
          }
        })
      } -->

  <!-- // axios=======// axios>>>>>>> 8e90bf36f683007ccaf52138359d495c539a1613
      // .post(
      // "https://www.zzzback.shop/api/login",
      // { userId:"youngble", password:"Youngble1!" },
      // {
      // headers: {
      // "Content-Type": "application/json",
      // "Authorization": `Bearer ${localStorage.getItem("token")}`
      // },
      // }
      // )
      // .then((res) => { console.log("Dd")}); -->
  <!-- </script> -->
  <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
  <script>
    Kakao.init("c51fcbffb9ee44d3b90e755eff2bf5b6");
  </script>
  <script type="module" src="firebase-messaging-sw.js"></script>
</body>

</html>